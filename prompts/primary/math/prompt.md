# 小学数学试卷结构化提示词（最终版）

## 🎯 任务

将数学试卷OCR文本转换为JSON结构。**只输出JSON，不输出解释。**

---

## 🚨 三大强制规则（必须100%遵守）

### 规则1：图片完整保留 + 位置正确

#### A. 所有图片URL必须保留
- 题目配图、选项图片、底图、示意图 → 全部保留
- URL必须完整（`https://` 开头，不截断）

#### B. 图片位置判断
| 图片用途 | 放置位置 |
|---------|---------|
| 整题共用（背景图、情景图） | 父题 `imgs` |
| 某小题专用（底图、局部图） | 该子题 `imgs` |
| 选项图片 | 父题 `imgs` + `opts[].txt` 用 `[img:索引]` |

**判断口诀：谁用谁放，共用放父，专用放子。**

#### C. 图片位置标注

**规则：只有图片嵌入文字中间时才使用 `[img:索引]`**

```json
// 情况1：图片嵌入在文字中间（需要标注）
{
  "content": "[img:0]把这些苹果平均分给2个小朋友...",
  "imgs": ["苹果.png"]
}

// 情况2：独立配图（不需要标注，不要追加到content）
{
  "content": "根据上图，计算长方形的面积。",  // ← 不要加 [img:0]
  "imgs": ["长方形.png"]
}

// 情况3：题干中间的图（需要标注）
{
  "content": "观察[img:0]，这是什么图形？",
  "imgs": ["图形.png"]
}

// 情况4：选项图片
{
  "content": "草药精灵把草药实验田划分成若干等份，下图正确的是（ ）。",  // ← 不要追加HTML或图片
  "imgs": ["A.png", "B.png"],
  "opts": [
    {"id": "A", "txt": "[img:0]", "img": ""},
    {"id": "B", "txt": "[img:1]", "img": ""}
  ]
}
```

**判断方法：**
- 图片在文字中间，打断了句子 → 用 `[img:索引]`
- 图片在题目上方/下方，独立存在 → **只放imgs，不标注，不追加到content**
- 题干中出现HTML标签（`<img src=...>`）→ **删除HTML，改用 imgs 数组**

---

### 规则2：LaTeX格式原样保留

#### A. 保留范围
**所有位置的 `$ ... $` 都要保留：**
- ✅ 题目 `content`
- ✅ 选项 `opts[].txt`
- ✅ 子题 `subqs[].content`

#### B. 常见符号对照（禁止转换）
| LaTeX | ✗ 不要转成 |
|-------|-----------|
| `$ \\times $` | `×` |
| `$ \\div $` | `÷` |
| `$ \\frac{1}{2} $` | `1/2` |
| `$ ^2 $` | `²` |

**铁律：看到 `$` 符号，里面一个字符都不动！**

---

### 规则3：正确拆分 + 内容不重复

#### A. 必须拆分的情况（创建 subqs）
- 多个独立算式（口算、列竖式、脱式计算）
- 多个单位换算
- 多个比较式（在○里填>、<或=）
- 应用题多个问题（(1)(2) 或 ①②）

**拆分后，父题 content 处理：**
- 如果有总的要求/引导语（如"口算""单位换算"） → 放 content
- **如果只是题型名称，无实质内容** → content 为**空字符串** `""`

#### B. 不拆分的情况
- 选择题（用 `opts`）
- 单一问题的应用题
- **完整情景的填空题**（一个情景，多个空格是连贯的，不是并列关系）

#### C. 拆分时内容分配（重要）
```json
// ✓ 正确：父题只放总要求
{
  "content": "请完成以下绘制：",  // 只有总要求
  "subqs": [
    {"no": "1.1", "content": "(1) 画一条线段。"},
    {"no": "1.2", "content": "(2) 如图，画直角。"}
  ]
}

// ✓ 正确：父题content为空（无总要求时）
{
  "content": "",  // 空字符串
  "subqs": [
    {"no": "3.7", "content": "30 分米 = （ ）米"},
    {"no": "3.8", "content": "5000 克 = （ ）千克"}
  ]
}

// ✗ 错误：父题包含小题内容
{
  "content": "请完成绘制：\n(1)画线段\n(2)画直角",  // 重复了
  "subqs": [...]
}
```

**规则：父题只放背景/总要求，子题放完整内容，禁止重复。如果无总要求，content为空字符串。**

---

## 📋 标准处理流程（每题必走）

```
1. 识别题型
   ↓
2. 提取图片（数量？位置？）
   ↓
3. 检查LaTeX（保留原样）
   ↓
4. 判断拆分（是否需要 subqs？）
   ↓
5. 分配内容（父子题不重复）
   ↓
6. 三重检查（图片+LaTeX+拆分）
   ↓
7. 输出JSON
```

---

## 📖 题型快速模板

### 模板1：口算题/计算题（必拆分）

```json
{
  "no": "1",
  "content": "口算。",
  "type": "计算",
  "imgs": [],
  "subqs": [
    {"no": "1.1", "content": "$ 105 \\times 4 = $"},
    {"no": "1.2", "content": "$ 3 \\times 700 = $"}
  ]
}
```

**要点：content只放"口算"，每个算式一个subq，LaTeX保留。**

---

### 模板2：单位换算（必拆分，父题content为空）

```json
{
  "no": "2",
  "content": "",  // ← 无总要求时，为空字符串
  "type": "填空",
  "imgs": [],
  "subqs": [
    {"no": "2.1", "content": "30分米=（ ）米"},
    {"no": "2.2", "content": "5000克=（ ）千克"}
  ]
}
```

**要点：每个换算一个subq，父题content为空。**

---

### 模板3：情景填空（不拆分）

```json
{
  "no": "3",
  "content": "$ 12 \\div 6 = $（ ），可以表示把（ ）平均分成（ ）份。",
  "type": "填空",
  "imgs": []
}
```

**要点：完整情景，多个空格是连贯的（不是并列关系），不拆分，LaTeX保留。**

**不拆分的判断标准：**
- 多个空格在同一个句子中，有语义关联
- 空格之间有连接词（"可以表示""每份是"等）
- 不是独立的换算/比较/计算

**例如：**
```json
// ✓ 不拆分：连贯情景
{
  "content": "制作香囊时，需要用棉线把布料缝合成袋。每一针缝出的线迹都是直的、有两个端点的，这种线的数学名称是（ ）。"
}

// ✗ 要拆分：并列换算
{
  "content": "",
  "subqs": [
    {"content": "30分米=（ ）米"},
    {"content": "5000克=（ ）千克"}
  ]
}
```

---

### 模板4：应用题（单问 - 不拆分）

```json
{
  "no": "4",
  "content": "小明有36颗糖，平均分给6个小朋友。每人分几颗？",
  "type": "应用",
  "imgs": ["情景图.png"]  // 如有背景图
}
```

---

### 模板5：应用题（多问 - 必拆分）

```json
{
  "no": "5",
  "content": "小明有36颗糖，平均分给6个小朋友。",  // 只放背景
  "type": "应用",
  "imgs": ["情景图.png"],  // 背景图在父题
  "subqs": [
    {"no": "5.1", "content": "(1) 每人分几颗？"},
    {"no": "5.2", "content": "(2) 可以分给几个小朋友？"}
  ]
}
```

**要点：背景在父题content，问题在subqs，图片在父题。**

---

### 模板6：作图题（多小题）

```json
{
  "no": "1",
  "content": "请完成以下绘制：",  // 只放总要求
  "type": "作图",
  "imgs": [],  // 父题通常无图
  "subqs": [
    {
      "no": "1.1",
      "content": "(1) 画一条线段。",
      "imgs": []  // 这个小题无图
    },
    {
      "no": "1.2",
      "content": "(2) 如图，画一个直角。",
      "imgs": ["底图.png"]  // 底图在这个小题
    }
  ]
}
```

**要点：总要求在父题，底图在用它的小题。**

---

### 模板7：选择题（文字选项 + LaTeX）

```json
{
  "no": "6",
  "content": "正确的算式是（ ）。",
  "type": "选择",
  "imgs": [],
  "opts": [
    {"id": "A", "txt": "$ 3.14 \\times 30^2 - 6^2 $", "img": ""},
    {"id": "B", "txt": "$ 3.14 \\times (30^2 - 6^2) $", "img": ""}
  ]
}
```

**要点：选项LaTeX必须保留。**

---

### 模板8：选择题（图片选项）

```json
{
  "no": "7",
  "content": "下图正确的是（ ）。",
  "type": "选择",
  "imgs": ["A.png", "B.png", "C.png"],  // 所有选项图
  "opts": [
    {"id": "A", "txt": "[img:0]", "img": ""},
    {"id": "B", "txt": "[img:1]", "img": ""},
    {"id": "C", "txt": "[img:2]", "img": ""}
  ]
}
```

**要点：选项图在父题imgs，opts用[img:索引]引用。**

---

## ⚠️ 常见错误速查

### 错误类型1：图片相关

| 错误 | 正确 |
|-----|------|
| `imgs: []` 但原题有图 | 所有图片URL都要保留 |
| 小题的底图放在父题 | 谁用谁放 |
| 独立配图加了 `[img:0]` | 独立配图不需要标注 |
| **独立配图追加到content** | **只放imgs，不追加到content** |
| **content中有HTML标签** | **删除HTML，图片URL放imgs数组** |
| 选项图片URL遗漏 | 放在父题imgs，opts用[img:索引] |

---

### 错误类型2：LaTeX相关

| 错误 | 正确 |
|-----|------|
| `"txt": "3.14 × 30²"` | `"txt": "$ 3.14 \\times 30^2 $"` |
| 题目LaTeX保留，选项LaTeX转换 | 所有位置都要保留 |
| `$ \\frac{1}{2} $` 改成 `1/2` | 原样保留 |

---

### 错误类型3：拆分相关

| 错误 | 正确 |
|-----|------|
| 多个算式不拆分 | 每个算式一个subq |
| 单位换算不拆分 | 每个换算一个subq |
| **拆分后父题content有内容** | **父题content为空字符串 `""`** |
| 应用题多问不拆分 | 每个问题一个subq |
| 选择题用 `subqs` | 选择题用 `opts` |
| 父题content包含小题内容 | 父题只放总要求，不重复 |
| **情景填空被拆分** | **连贯情景不拆分** |

---

## ✅ 输出前三重强制检查

### 检查1：图片（逐题核对）

```
第1题：
- [ ] 原题图片数量：___ 张
- [ ] JSON中图片数量：___ 张
- [ ] 数量一致？位置正确？

第2题：
- [ ] 原题图片数量：___ 张
- [ ] JSON中图片数量：___ 张
- [ ] 数量一致？位置正确？
```

**重点检查：**
- [ ] 背景图在父题？
- [ ] 底图在对应小题？
- [ ] 选项图在父题+opts引用？

---

### 检查2：LaTeX（逐项核对）

```
- [ ] 题目content中的LaTeX保留了？
- [ ] 选项opts[].txt中的LaTeX保留了？
- [ ] 子题subqs[].content中的LaTeX保留了？
- [ ] 所有 $ ... $ 都原样？
```

---

### 检查3：拆分（逐题核对）

```
- [ ] 口算题/单位换算拆分了？
- [ ] **拆分后父题content为空字符串？**（如无总要求）
- [ ] 应用题多问拆分了？
- [ ] 父题content只有总要求（无小题内容）？
- [ ] **情景填空是否误拆分？**（连贯情景不拆）
- [ ] 选择题用 opts（不是subqs）？
```

---

## 📊 完整示例（综合所有规则）

```json
{
  "no": "一",
  "title": "综合练习",
  "score": "30分",
  "qs": [
    {
      "no": "1",
      "content": "口算。",
      "type": "计算",
      "score": "6分",
      "imgs": [],
      "subqs": [
        {"no": "1.1", "content": "$ 105 \\times 4 = $"},
        {"no": "1.2", "content": "$ 3 \\times 700 = $"}
      ]
    },
    {
      "no": "2",
      "content": "[img:0]把（ ）个苹果平均分给2个小朋友。",
      "type": "填空",
      "score": "3分",
      "imgs": ["https://.../苹果.png"]
    },
    {
      "no": "3",
      "content": "正确的算式是（ ）。",
      "type": "选择",
      "score": "2分",
      "imgs": [],
      "opts": [
        {"id": "A", "txt": "$ 3.14 \\times 30^2 - 6^2 $", "img": ""},
        {"id": "B", "txt": "$ 3.14 \\times (30^2 - 6^2) $", "img": ""}
      ]
    },
    {
      "no": "4",
      "content": "下图正确的是（ ）。",
      "type": "选择",
      "score": "2分",
      "imgs": ["https://.../A.png", "https://.../B.png", "https://.../C.png"],
      "opts": [
        {"id": "A", "txt": "[img:0]", "img": ""},
        {"id": "B", "txt": "[img:1]", "img": ""},
        {"id": "C", "txt": "[img:2]", "img": ""}
      ]
    },
    {
      "no": "5",
      "content": "小明有糖，如图所示。",
      "type": "应用",
      "score": "8分",
      "imgs": ["https://.../情景图.png"],
      "subqs": [
        {"no": "5.1", "content": "(1) 每人分几颗？"},
        {"no": "5.2", "content": "(2) 可以分给几个小朋友？"}
      ]
    },
    {
      "no": "6",
      "content": "请完成以下绘制：",
      "type": "作图",
      "score": "9分",
      "imgs": [],
      "subqs": [
        {
          "no": "6.1",
          "content": "(1) 画一条线段。",
          "score": "6分",
          "imgs": []
        },
        {
          "no": "6.2",
          "content": "(2) 如图，画一个直角。",
          "score": "3分",
          "imgs": ["https://.../底图.png"]
        }
      ]
    }
  ]
}
```

---

## 🎯 记忆口诀

**三大规则：**
1. **图片**：全保留，位置准（谁用谁放）
2. **LaTeX**：见 `$` 不动（包括选项）
3. **拆分**：该拆就拆，父子不重复

**处理流程：**
```
识题型 → 提图片 → 查LaTeX → 判拆分 → 分内容 → 三检查 → 出JSON
```

**质量标准：**
- 图片一个不丢，位置一个不错
- LaTeX一个字符不改
- 该拆的全拆，父子内容不重复